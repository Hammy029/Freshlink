<h2 class="text-2xl font-bold mb-6 text-gray-800">All Orders (Admin View)</h2>

<!-- âœ… Toast Notification -->
<div
  *ngIf="copyToastVisible"
  class="fixed top-5 right-5 bg-green-600 text-white px-4 py-2 rounded shadow-md z-50 animate-fade-in-out"
>
  âœ… Product ID copied!
</div>

<!-- ðŸŒ€ Loading spinner -->
<div *ngIf="loading" class="text-center text-indigo-600 font-medium my-4">
  Loading orders...
</div>

<div *ngIf="!loading && orders.length > 0; else noOrders" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
  <div
    *ngFor="let order of orders"
    class="bg-white border rounded-xl shadow-sm p-5 hover:shadow-md transition-all flex flex-col justify-between"
  >
    <div class="flex-1 space-y-4">
      <!-- ðŸ›’ Product Details -->
      <div>
        <h3 class="text-lg font-semibold text-indigo-700 mb-3">Ordered Products</h3>
        <ul class="space-y-3">
          <li
            *ngFor="let item of order.items"
            class="bg-gray-50 p-3 rounded-md border text-sm text-gray-700"
          >
            <p><span class="font-medium">Product:</span> {{ item.product?.name || 'N/A' }}</p>

            <!-- âœ… Copyable Product ID -->
            <p class="flex items-center space-x-2">
              <span class="font-medium">Product ID:</span>
              <span
                class="bg-gray-200 text-xs text-gray-700 px-2 py-1 rounded cursor-pointer hover:bg-gray-300 transition"
                title="Click to copy"
                (click)="copyToClipboard(item.product?._id)"
              >
                {{ item.product?._id || 'N/A' }}
              </span>
            </p>

            <p><span class="font-medium">Category:</span> {{ item.product?.category?.name || 'N/A' }}</p>
            <p><span class="font-medium">Farm:</span> {{ item.product?.farm?.name || 'Unknown' }}</p>
            <p><span class="font-medium">Price:</span> KES {{ item.product?.price || 0 }}</p>
            <p><span class="font-medium">Quantity:</span> {{ item.quantity }}</p>
            <p><span class="font-medium">Subtotal:</span> KES {{ (item.product?.price || 0) * item.quantity }}</p>
          </li>
        </ul>
      </div>

      <!-- Divider -->
      <hr class="my-4 border-gray-300" />

      <!-- ðŸ“¦ Order Summary -->
      <div class="text-sm text-gray-800 space-y-2">
        <h4 class="text-indigo-600 font-semibold">Order Summary</h4>
        <p><span class="font-medium">Order ID:</span> {{ order._id }}</p>
        <p>
          <span class="font-medium">Total:</span>
          <span class="text-green-700 font-bold">{{ order.totalAmount | currency: 'KES' }}</span>
        </p>
        <p><span class="font-medium">Date:</span> {{ order.createdAt | date: 'medium' }}</p>
      </div>

      <!-- ðŸ‘¤ User Info -->
      <div class="text-sm text-gray-800 space-y-1">
        <h4 class="text-indigo-600 font-semibold">Customer Details</h4>
        <p><span class="font-medium">Name:</span> {{ order.userId?.name || 'N/A' }}</p>
        <p><span class="font-medium">Email:</span> {{ order.userId?.email || 'N/A' }}</p>
      </div>
    </div>

    <!-- ðŸš« Cancel Order Button pinned to bottom -->
    <div class="mt-6">
      <button
        (click)="cancelOrder(order._id)"
        class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-md transition"
      >
        Cancel Order
      </button>
    </div>
  </div>
</div>

<!-- ðŸ•³ No orders fallback -->
<ng-template #noOrders>
  <p class="text-center text-gray-500 text-lg mt-8">No orders found.</p>
</ng-template>
